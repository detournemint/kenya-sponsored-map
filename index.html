<!DOCTYPE html>
<html>
<head>
<meta charset=utf-8 />
<title>Loading markers from CSV</title>
<meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
<script src='https://api.mapbox.com/mapbox.js/v2.2.4/mapbox.js'></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
<link href='https://api.mapbox.com/mapbox.js/v2.2.4/mapbox.css' rel='stylesheet' />
<style>
  body { margin:0; padding:0; }
  #map { position:absolute; top:0; bottom:0; width:100%; }
</style>
</head>
<body>
<script src='https://api.mapbox.com/mapbox.js/plugins/leaflet-omnivore/v0.2.0/leaflet-omnivore.min.js'></script>
<script src="lib/jquery-csv-0.71.js"></script>
<div id='map'></div>

<script>

$.ajax({
  type: "GET",
  url: "http://localhost:8080/data/rows.csv",
  dataType: "text",
  success: function(data){
    locations = $.csv.toObjects(data);
    var map = L.mapbox.map('map', 'mapbox.streets')
        .setView([1, 36], 6)
    locations.forEach(function(element, index){
      lat_long = element.Location2_Secondary.replace(/[()]/g, '').replace(/\s/g, '').split(',')
      if(typeof lat_long[0] === 'undefined' || typeof lat_long[1] === 'undefined'){
        console.log(element.EPGeoName + " does not have valid location data, skipping")
      } else {
        var marker = L.marker([lat_long[0], lat_long[1]], {
          icon: L.mapbox.marker.icon({
              'marker-size': 'large',
              'marker-color': '#fa0'
          })
        }).addTo(map);
        marker.bindPopup("yolo")
      }
    });
  }
});

L.mapbox.accessToken = 'pk.eyJ1IjoiZ3JlZ2dhd2F0dCIsImEiOiJjaWppNGpzZm4wMnZxdHRtNWNuaHFsOWE5In0.XZJCOdDSALLBYWBt4bHmlw';



</script>
</body>
</html>
